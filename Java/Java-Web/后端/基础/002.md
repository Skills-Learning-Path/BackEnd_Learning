# Web基础知识

## HTTP

http（超文本传输协议）是一个简单的请求-响应协议，它通常运行在TCP之上

-   文本：html、字符串
-   超文本：图片、音乐、视频、定位、地图
-   HTTP：80端口
-   HTTPS：443端口

### 两个时代

-   HTTP/1.0：客户端可以与web服务器连接后，只能获得一个web资源，断开连接
-   HTTP/1.1：客户端可以与web服务器连接后，可以获得多个web资源

### 请求

客户端向服务端发送请求

```
Request URL: https://www.baidu.com/ （请求地址）
Request Method: GET （请求方法）
Status Code: 200 OK（状态码）
Remote Address: 104.193.88.123:443 （远程地址）
```

-   请求行

    请求行中的方式：GET，POST，DELETE，PUT

    -   GET：请求能携带的参数比较少，大小有限制，会在浏览器的url地址栏显示数据内容，不安全，但高效
    -   POST：请求能携带的参数没有限制，大小没有限制，不会在浏览器的url地址栏显示数据内容，安全，但不高效

-   消息头

    -   Accpet：告诉浏览器所支持的数据类型
    -   Accept-Encoding：支持哪种编码格式
        -   GBK
        -   UTF-8
        -   GB2312
        -   ISO8859-1
    -   Accept-Language：语言环境
    -   Cache-Control：缓存控制
    -   Connection：告诉浏览器请求完成是断开还是保持连接
    -   HOST：主机

### 响应

服务端向客户端发送响应

```
Cache-Control: private（缓存控制）
Connection: keep-alive（连接-保持连接）
Content-Encoding: gzip（编码）
Content-Type: text/html（类型）
```

```
Accept: text/html
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cache-Control: max-age=0
Connection: keep-alive
```

-   响应体

    -   Accpet：告诉浏览器所支持的数据类型
    -   Accept-Encoding：支持哪种编码格式
        -   GBK
        -   UTF-8
        -   GB2312
        -   ISO8859-1
    -   Accept-Language：语言环境
    -   Cache-Control：缓存控制
    -   Connection：告诉浏览器请求完成是断开还是保持连接
    -   HOST：主机
    -   refresh：告诉客户端多久刷新
    -   Location：让网页重新定位

-   响应状态码

    -   200：请求响应成功

    -   3xx：请求重定向

    -   4xx：找不到资源

        404：资源不存在

    -   5xx：服务器代码错误

        502：网关错误

## Servlet

Servlet是一个接口，开发Servlet程序只需要：

-   编写一个类，实现Servlet接口
-   把开发好的java类部署到web服务器中

Servlet有两个实现类：HttpServlet、GenericServlet

依赖包：

```xml
<dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>4.0.1</version>
            <scope>provided</scope>
        </dependency>
        <!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api -->
        <dependency>
            <groupId>javax.servlet.jsp</groupId>
            <artifactId>javax.servlet.jsp-api</artifactId>
            <version>2.3.3</version>
            <scope>provided</scope>
        </dependency>
```

1.  编写一个普通类

2.  实现一个接口，直接继承HttpServlet

3.  重写方法

4.  编写Servlet映射

    ```xml
    <web-app>
      <display-name>Archetype Created Web Application</display-name>
      <servlet>
        <servlet-name>hello</servlet-name>
        <servlet-class>com.servlet.HelloServlet</servlet-class>
      </servlet>
      <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
      </servlet-mapping>
    </web-app>
    ```

5.  配置tomcat

6.  启动测试

```java
public class HelloServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        PrintWriter writer = resp.getWriter();
        writer.print("hello Servlet");
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        this.doGet(req, resp);
    }
}

```

### 运行原理

![img](res/1.jpg)

### Mapping问题

-   一个Servlet可以指定一个映射路径

    ```xml
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
      </servlet-mapping>
    ```

-   一个Servlet可以指定多个映射路径

    ```xml
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello1</url-pattern>
      </servlet-mapping>
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello2</url-pattern>
      </servlet-mapping>
    ```

-   一个Servlet可以指定通用映射路径

    ```xml
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello/*</url-pattern>
      </servlet-mapping>
    ```

-   一个Servlet可以指定后缀或者前缀路径等

    ```xml
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>*.do</url-pattern>
      </servlet-mapping>
    ```

    注意：*前面不能加项目映射的路径

-   优先级问题

    指定了固有的映射路径优先级最高，如果找不到就会走默认的处理请求

### HttpServlet常用方法

```java
//        this.getInitParameter() 初始化配置
//        this.getServletConfig() Servlet配置
//        this.getServletContext() Servlet上下文
```

### ServletContext

web容器在启动的时候，它会为每个web程序都创建一个对应的ServletContext对象，它代表了当前的web应用

-   共享数据：在Servlet中保存的数据可以在另一个Servlet中拿到

    ![img](res/2.jpg)

    ```java
    //Servlet 1
    ServletContext servletContext = this.getServletContext();
    String username = "信息";
    servletContext.setAttribute("username",username);//将一个数据保存在ServletContext中
    //Servlet 2
    resp.setContentType("text/html");
    resp.setCharacterEncoding("utf-8");
    PrintWriter writer = resp.getWriter();
    ServletContext servletContext = this.getServletContext();
    String username =(String) servletContext.getAttribute("username");
    writer.print(username);
    ```

-   获取初始化参数

    1.  配置参数

        ```xml
        <context-param>
            <param-name>url</param-name>
            <param-value>jdbc:mysql//localhost:3306/aaa</param-value>
          </context-param>
        ```

    2.  获取参数

        ```java
        ServletContext servletContext = this.getServletContext();
        String url = servletContext.getInitParameter("url");
        writer.print(url);
        ```

-   请求转发

    ```java
    ServletContext context = this.getServletContext();
    RequestDispatcher requestDispatcher = context.getRequestDispatcher("/hello");//转发的请求路径
    requestDispatcher.forward(req,resp);//请求转发
    ```

-   读取资源文件

    Properties类

    ```java
    Properties properties = new Properties();
    properties.load(servletContext.getResourceAsStream("/WEB-INF/classes/db.properties"));
    String name = properties.getProperty("name");
    String password = properties.getProperty("password");
    writer.print(name);
    writer.print(password);
    ```

## Request与Response

web服务器接收到客户端的http请求，针对这个请求，分别创建一个代表请求的HttpServletRequest对象，代表响应的HttpServletResponse

-   如果要获取客户端请求过来的参数：HttpServletRequest
-   如果要给客户端响应一些信息：HttpServletResponse

### HttpServletResponse

1.  简单分类

    -   负责向浏览器发送数据的方法

    ```java
    public ServletOutputStream getOutputStream() throws IOException;
    public PrintWriter getWriter() throws IOException;
    ```

    -   负责向浏览器发送响应头的方法

    ```java
    public void setCharacterEncoding(String charset);
    public void setContentLength(int len);
    public void setContentLengthLong(long len);
    public void setContentType(String type);
    ```

    ```java
    public void setDateHeader(String name, long date);
    public void addDateHeader(String name, long date);
    public void setHeader(String name, String value);
    public void addHeader(String name, String value);
    public void setIntHeader(String name, int value);
    public void addIntHeader(String name, int value);
    ```

    响应的状态码常量

    ```java
    	/**
         * Status code (100) indicating the client can continue.
         */
        public static final int SC_CONTINUE = 100;
    
        /**
         * Status code (101) indicating the server is switching protocols
         * according to Upgrade header.
         */
        public static final int SC_SWITCHING_PROTOCOLS = 101;
    
        /**
         * Status code (200) indicating the request succeeded normally.
         */
        public static final int SC_OK = 200;
    
        /**
         * Status code (201) indicating the request succeeded and created
         * a new resource on the server.
         */
        public static final int SC_CREATED = 201;
    
        /**
         * Status code (202) indicating that a request was accepted for
         * processing, but was not completed.
         */
        public static final int SC_ACCEPTED = 202;
    
        /**
         * Status code (203) indicating that the meta information presented
         * by the client did not originate from the server.
         */
        public static final int SC_NON_AUTHORITATIVE_INFORMATION = 203;
    
        /**
         * Status code (204) indicating that the request succeeded but that
         * there was no new information to return.
         */
        public static final int SC_NO_CONTENT = 204;
    
        /**
         * Status code (205) indicating that the agent <em>SHOULD</em> reset
         * the document view which caused the request to be sent.
         */
        public static final int SC_RESET_CONTENT = 205;
    
        /**
         * Status code (206) indicating that the server has fulfilled
         * the partial GET request for the resource.
         */
        public static final int SC_PARTIAL_CONTENT = 206;
    
        /**
         * Status code (300) indicating that the requested resource
         * corresponds to any one of a set of representations, each with
         * its own specific location.
         */
        public static final int SC_MULTIPLE_CHOICES = 300;
    
        /**
         * Status code (301) indicating that the resource has permanently
         * moved to a new location, and that future references should use a
         * new URI with their requests.
         */
        public static final int SC_MOVED_PERMANENTLY = 301;
    
        /**
         * Status code (302) indicating that the resource has temporarily
         * moved to another location, but that future references should
         * still use the original URI to access the resource.
         *
         * This definition is being retained for backwards compatibility.
         * SC_FOUND is now the preferred definition.
         */
        public static final int SC_MOVED_TEMPORARILY = 302;
    
        /**
        * Status code (302) indicating that the resource reside
        * temporarily under a different URI. Since the redirection might
        * be altered on occasion, the client should continue to use the
        * Request-URI for future requests.(HTTP/1.1) To represent the
        * status code (302), it is recommended to use this variable.
        */
        public static final int SC_FOUND = 302;
    
        /**
         * Status code (303) indicating that the response to the request
         * can be found under a different URI.
         */
        public static final int SC_SEE_OTHER = 303;
    
        /**
         * Status code (304) indicating that a conditional GET operation
         * found that the resource was available and not modified.
         */
        public static final int SC_NOT_MODIFIED = 304;
    
        /**
         * Status code (305) indicating that the requested resource
         * <em>MUST</em> be accessed through the proxy given by the
         * <code><em>Location</em></code> field.
         */
        public static final int SC_USE_PROXY = 305;
    
         /**
         * Status code (307) indicating that the requested resource 
         * resides temporarily under a different URI. The temporary URI
         * <em>SHOULD</em> be given by the <code><em>Location</em></code> 
         * field in the response.
         */
        public static final int SC_TEMPORARY_REDIRECT = 307;
    
        /**
         * Status code (400) indicating the request sent by the client was
         * syntactically incorrect.
         */
        public static final int SC_BAD_REQUEST = 400;
    
        /**
         * Status code (401) indicating that the request requires HTTP
         * authentication.
         */
        public static final int SC_UNAUTHORIZED = 401;
    
        /**
         * Status code (402) reserved for future use.
         */
        public static final int SC_PAYMENT_REQUIRED = 402;
    
        /**
         * Status code (403) indicating the server understood the request
         * but refused to fulfill it.
         */
        public static final int SC_FORBIDDEN = 403;
    
        /**
         * Status code (404) indicating that the requested resource is not
         * available.
         */
        public static final int SC_NOT_FOUND = 404;
    
        /**
         * Status code (405) indicating that the method specified in the
         * <code><em>Request-Line</em></code> is not allowed for the resource
         * identified by the <code><em>Request-URI</em></code>.
         */
        public static final int SC_METHOD_NOT_ALLOWED = 405;
    
        /**
         * Status code (406) indicating that the resource identified by the
         * request is only capable of generating response entities which have
         * content characteristics not acceptable according to the accept
         * headers sent in the request.
         */
        public static final int SC_NOT_ACCEPTABLE = 406;
    
        /**
         * Status code (407) indicating that the client <em>MUST</em> first
         * authenticate itself with the proxy.
         */
        public static final int SC_PROXY_AUTHENTICATION_REQUIRED = 407;
    
        /**
         * Status code (408) indicating that the client did not produce a
         * request within the time that the server was prepared to wait.
         */
        public static final int SC_REQUEST_TIMEOUT = 408;
    
        /**
         * Status code (409) indicating that the request could not be
         * completed due to a conflict with the current state of the
         * resource.
         */
        public static final int SC_CONFLICT = 409;
    
        /**
         * Status code (410) indicating that the resource is no longer
         * available at the server and no forwarding address is known.
         * This condition <em>SHOULD</em> be considered permanent.
         */
        public static final int SC_GONE = 410;
    
        /**
         * Status code (411) indicating that the request cannot be handled
         * without a defined <code><em>Content-Length</em></code>.
         */
        public static final int SC_LENGTH_REQUIRED = 411;
    
        /**
         * Status code (412) indicating that the precondition given in one
         * or more of the request-header fields evaluated to false when it
         * was tested on the server.
         */
        public static final int SC_PRECONDITION_FAILED = 412;
    
        /**
         * Status code (413) indicating that the server is refusing to process
         * the request because the request entity is larger than the server is
         * willing or able to process.
         */
        public static final int SC_REQUEST_ENTITY_TOO_LARGE = 413;
    
        /**
         * Status code (414) indicating that the server is refusing to service
         * the request because the <code><em>Request-URI</em></code> is longer
         * than the server is willing to interpret.
         */
        public static final int SC_REQUEST_URI_TOO_LONG = 414;
    
        /**
         * Status code (415) indicating that the server is refusing to service
         * the request because the entity of the request is in a format not
         * supported by the requested resource for the requested method.
         */
        public static final int SC_UNSUPPORTED_MEDIA_TYPE = 415;
    
        /**
         * Status code (416) indicating that the server cannot serve the
         * requested byte range.
         */
        public static final int SC_REQUESTED_RANGE_NOT_SATISFIABLE = 416;
    
        /**
         * Status code (417) indicating that the server could not meet the
         * expectation given in the Expect request header.
         */
        public static final int SC_EXPECTATION_FAILED = 417;
    
        /**
         * Status code (500) indicating an error inside the HTTP server
         * which prevented it from fulfilling the request.
         */
        public static final int SC_INTERNAL_SERVER_ERROR = 500;
    
        /**
         * Status code (501) indicating the HTTP server does not support
         * the functionality needed to fulfill the request.
         */
        public static final int SC_NOT_IMPLEMENTED = 501;
    
        /**
         * Status code (502) indicating that the HTTP server received an
         * invalid response from a server it consulted when acting as a
         * proxy or gateway.
         */
        public static final int SC_BAD_GATEWAY = 502;
    
        /**
         * Status code (503) indicating that the HTTP server is
         * temporarily overloaded, and unable to handle the request.
         */
        public static final int SC_SERVICE_UNAVAILABLE = 503;
    
        /**
         * Status code (504) indicating that the server did not receive
         * a timely response from the upstream server while acting as
         * a gateway or proxy.
         */
        public static final int SC_GATEWAY_TIMEOUT = 504;
    
        /**
         * Status code (505) indicating that the server does not support
         * or refuses to support the HTTP protocol version that was used
         * in the request message.
         */
        public static final int SC_HTTP_VERSION_NOT_SUPPORTED = 505;
    ```

2.  常见应用

    -   向浏览器输出消息
    -   下载文件
        1.  要获取下载文件的路径
        2.  下载的文件名
        3.  让浏览器支持能够下载我们需要的东西
        4.  获取下载文件的输入流
        5.  创建缓冲区
        6.  获取OutputStream对象
        7.  将流写入到buffer缓冲区
        8.  将缓冲区中的数据输出到客户端

    ```java
    String realPath = this.getServletContext().getRealPath("/1.jpg");
    String fileName = realPath.substring(realPath.lastIndexOf("\\") + 1);
    resp.setHeader("Content-Disposition","attachment; filename="+ URLEncoder.encode(fileName,"UTF-8"));
    FileInputStream fileInputStream = new FileInputStream(realPath);
    int len = 0;
    byte[] buffer = new byte[1024];
    ServletOutputStream outputStream = resp.getOutputStream();
    while((len=fileInputStream.read(buffer))>0){
          outputStream.write(buffer,0,len);
    }
    fileInputStream.close();
    outputStream.close();
    ```

    

### HttpServletRequest

