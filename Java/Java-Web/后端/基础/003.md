# 补充内容

## Cookie、Session

### 会话

-   会话：用户打开浏览器，点击了很多超链接，访问了多个web资源，关闭浏览器，这个过程称为会话

-   有状态会话：服务端知道客户端曾经访问过
    1.  服务端给客户端一个cookie，客户端下次访问服务端带上就可以
    2.  服务器登记客户端来过，下次来的时候来匹配session

### 保存会话的两种技术

-   cookie

    客户端技术（响应、请求）

    1.  从请求中拿到cookie信息
    2.  服务器响应给客户端cookie

    常用方法：

    -   `Cookie[] cookies = req.getCookies()`：获得cookie
    -   `cookie.getName()`：获取cookie中的key
    -   `cookie.getValue()`：获取cookie中的value
    -   `new Cookie(key, value)`：新建一个cookie
    -   `cookie.setMaxAge(seconds)`：设置cookie有效期
    -   `resp.addCookie(cookie)`：响应给客户端一个cookie

    示例代码：

    ```java
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
            req.setCharacterEncoding("utf-8");
            resp.setCharacterEncoding("utf-8");
            resp.setHeader("content-type","text/html;charset=UTF-8");
            PrintWriter out = resp.getWriter();
            Cookie[] cookies = req.getCookies();
            if(cookies!=null){
                boolean flag=false;
                for (int i = 0; i < cookies.length; i++) {
                    if(cookies[i].getName().equals("lastlogin")){
                        flag=true;
                        long l = Long.parseLong(cookies[i].getValue());
                        Date date = new Date(l);
                        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                        out.write(sdf.format(date));
                        break;
                    }
                }
                if(!flag){
                    out.write("第一次访问");
                }
            }
            else{
                out.write("第一次访问");
            }
            Cookie cookie = new Cookie("lastlogin", System.currentTimeMillis() + "");
            cookie.setMaxAge(20);
            resp.addCookie(cookie);
        }
    ```

    cookie一般会保存在本地的用户目录下

    注意事项：

    1.  一个cookie只能保存一个信息
    2.  一个web站点可以给浏览器发送多个cookie，每个站点最多存放20个cookie
    3.  cookie大小有限制4KB
    4.  浏览器的cookie上限一般为300个

    删除cookie：

    1.  不设置有效期，关闭浏览器自动失效
    2.  设置有效期为0

-   session

    服务端技术，利用这个技术可以保存用户的会话技术

