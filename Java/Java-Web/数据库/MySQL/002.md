# Java程序操作MySQL

## JDBC概念

-   Java Database Connectivity：Java语言操作数据库

-   本质：官方定义的一套操作所有关系型数据库的规则，即接口

## JDBC入门

-   步骤：
    1.  导入驱动jar包
    2.  注册驱动
    3.  获取数据库连接对象 Connection
    4.  定义sql
    5.  获取sql语句的对象 Statement
    6.  执行sql，接收返回结果
    7.  处理结果
    8.  释放资源

```java
Class.forName("com.mysql.jdbc.Driver");
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/school", "root", "123456");
String sql = "update testmd5 set name='zhangsansan' where name='zhangsan'";
Statement statement = conn.createStatement();
int count = statement.executeUpdate(sql);
System.out.println(count);
statement.close();
conn.close();
```

-   对象详解

    1.  DriverManager：驱动管理对象

        -   功能：

            1.  注册驱动

                ```java
                static void registerDriver(Driver driver);
                ```

                注册于给定的驱动程序DriverManager

                使用`Class.forName("com.mysql.jdbc.Driver");`注册驱动

                注意：MySQL5之后的驱动jar包可以省略注册驱动的步骤

            2.  获取数据库连接

                ```java
                static Connection getConnection(String url, String user, String password);
                ```

                -   url：指定连接的路径 `jdbc:mysql://ip地址:端口号/数据库名称`
                -   user：用户名
                -   password：密码

    2.  Connection：数据库连接对象

        -   功能

            1.  获取执行sql的对象

                ```java
                Statement createStatement();
                PreparedStatement preparedStatement(String sql);
                ```

            2.  管理事务

                -   开启事务

                    ```java
                    void setAutoCommit(boolean autoCommit);
                    ```

                    设置参数为false即开启事务

                -   提交事务

                    ```java
                    void commit()
                    ```

                -   回滚事务

                    ```java
                    void rollback()
                    ```

    3.  Statement：执行SQL的对象

        用于执行静态SQL语句并返回其生成结果的对象

        -   执行SQL
            1.  `boolean execute(String sql)`：可以执行任意的sql
            2.  `int executeUpdate(String sql)`：执行DML、DDL语句，返回值是影响的行数（可以用来判断语句是否执行成功）
            3.  `ResultSet executeQuery(String sql)`：执行DQL语句

    4.  ResultSet：结果集对象

        -   `boolean next()`：游标向下移动一行
        -   `getXxx(参数)`：获取数据，Xxx代表数据类型，参数可以为int（列的编号，从1开始）或String（列名称）
        -   使用步骤
            1.  游标向下移动一行
            2.  判断是否有数据
            3.  获取数据

        ```java
        public static void main( String[] args ) {
                Statement statement=null;
                Connection conn=null;
                ResultSet rs=null;
                try {
                    Class.forName("com.mysql.jdbc.Driver");
                    conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/school", "root", "123456");
                    String sql = "select subjectno,subjectname from subject";
                    statement = conn.createStatement();
                    rs = statement.executeQuery(sql);
                    while(rs.next()){
                        int id=rs.getInt(1);
                        String name=rs.getString(2);
                        System.out.println(id+"  "+name);
                    }
                }
                catch (Exception e){
                    e.printStackTrace();
                }
                finally {
                    if(rs!=null){
                        try {
                            rs.close();
                        } catch (SQLException throwables) {
                            throwables.printStackTrace();
                        }
                    }
                    if(statement!=null) {
                        try {
                            statement.close();
                        } catch (SQLException throwables) {
                            throwables.printStackTrace();
                        }
                    }
                    if(conn!=null) {
                        try {
                            conn.close();
                        } catch (SQLException throwables) {
                            throwables.printStackTrace();
                        }
                    }
                }
        
            }
        ```

    5.  PreparedStatement：执行SQL的对象

