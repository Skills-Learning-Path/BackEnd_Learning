# 网络编程

## 网络编程入门

### 软件结构

-   C/S结构：客户端/服务器结构
-   B/S结构：浏览器/服务器结构

### 网络通信协议

-   网络通信协议：在计算机网络中连接和通信的规则称为网络通信协议
-   TCP/IP协议：传输互联协议/因特网互联协议是最基本最广泛的协议

### 协议分类

-   UDP协议：用户数据报协议，是一个面向无连接的协议，消耗资源小、通信效率高，一般用于音频视频和普通数据的传输，不能保证数据的完整性

    特点：数据被限制在64kb以内

-   TCP协议：传输控制协议，是一个面向连接的通信协议，先建立逻辑连接再发送数据，提供了可靠无差错的数据传输

    创建连接需要“三次握手”

    1.  客户端向服务端发送连接请求，等待服务器确认
    2.  服务端向客户端回应一个响应，通知客户端收到请求
    3.  客户端再次向服务端发送确认信息，确认连接

    通过三次握手可以保证数据传输的安全，一般用于文件上传、文件下载、网页浏览等

### 网络编程三要素

1. 协议

    计算机网络通信中必须遵守的规则

2. IP地址

    互联网的协议地址，是计算机在一个网络中唯一的编号

-   IPv4：32位的二进制数，通常被分为4个字节0-255之间的十进制整数
-   IPv6：128位的二进制数，通常被分为8组十六进制数

    本机ip地址：127.0.0.1、localhost

3. 端口号

    用两个字节表示的整数，可以唯一标识设备中的进程，范围是0-65535

    1024之前的端口号用于知名的网络服务和应用

## TCP通信程序

### 通信步骤

1.  服务端程序需要事先启动，等待客户端连接
2.  客户端主动连接服务器端，连接成功才能通信

在Java中，客户端使用java.net.Socket类，服务端使用java.net.ServerSocket类

注意：

1.  多个客户端同时和服务端交互，服务端必须明确和哪个客户端进行交互
2.  多个客户端同时和服务端交互，就需要使用多个IO流对象（获取到客户端的Socket，使用客户端的IO流进行交互）

### Socket类

java.net.Socket类实现客户端套接字

1.  构造方法

    `Socket(String host, int port)`:创建一个流套接字并将其连接到指定主机上的指定端口号

2.  成员方法

    `OutputStream getOutputStream()`：返回此套接字的输出流

    `InputStream getInputStream()`：返回此套接字的输入流

    `void close()`：关闭此套接字

3.  实现步骤

    （1）创建一个客户端对象Socket，构造方法中指定服务器的ip地址和端口号

    （2）使用Socket对象中的方法getOutputStream获取网络字节输出流对象

    （3）使用网络字节输出流对象的write方法给服务器发送数据

    （4）使用Socket对象中的方法getInputStream获取网络字节输入流对象

    （5）使用网络字节输入流对象的read方法读取服务器回写的数据

    （6）释放资源（close）

4.  注意：

    （1）客户端和服务端进行交互，必须使用Socket中提供的网络流，不能使用自己创建的流对象

    （2）当客户端创建Socket对象时就会请求服务器

### ServerSocket类

java.net.ServerSocket类实现服务端套接字

1.  构造方法

    `ServerSocket(int port)`：创建绑定到特定端口号的服务器套接字

2.  成员方法

    `Socket accept()`：监听并接受到此套接字的连接

3.  实现步骤

    （1）创建一个服务端对象ServerSocket，构造方法中指定端口号

    （2）使用ServerSocket对象中的方法accpet获取请求的客户端Socket对象

    （3）使用Socket对象中的方法getInputStream获取网络字节输入流对象

    （4）使用网络字节输入流对象的read方法读取客户端发送的数据

    （5）使用Socket对象中的方法getOutputStream获取网络字节输出流对象

    （6）使用网络字节输出流对象的write方法给客户端回写数据

    （6）释放资源（close）