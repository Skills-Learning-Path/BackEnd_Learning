# JVM

## JVM体系结构

### JVM的位置

<img src="57.png" alt="57" style="zoom: 50%;" />

### JVM整体结构

<img src="58.jpg" alt="58" style="zoom:67%;" />

<img src="59.jpg" alt="59" style="zoom:67%;" />

-   注意：
    1.  多线程共享方法区和堆
    2.  对于Java栈、本地方法栈和程序计数器，每个线程独有一份
    3.  执行引擎分为解释器、JIT即时编译器（后端编译器）和垃圾回收器

### Java代码执行流程

<img src="60.jpg" alt="60" style="zoom:67%;" />

Java编译（前端编译）分为词法分析、语法分析、语义分析、字节码生成等步骤。

### JVM架构模型

Java编译器输出的指令流分为两种：基于栈的指令集架构和基于寄存器的指令集架构

-   基于栈的指令集架构
    -   设计和实现更简单，适用于资源受限的系统
    -   避开了寄存器的分配难题：使用零地址指令方式分配
    -   指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。指令集更小，编译器容易实现
    -   不需要硬件支持，可移植性更好，更好实现跨平台
-   基于寄存器的指令集架构
    -   典型的应用是x86的二进制指令集：比如传统的PC以及Android的Davlik虚拟机
    -   指令集架构完全依赖于硬件，可移植性差
    -   性能优秀，执行更高效
    -   花费更少的指令去完成一项操作
    -   在大部分情况下，基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主，而基于栈式架构的指令集却是以零地址指令为主

由于跨平台的特性，Java的指令都是根据栈来设计的。